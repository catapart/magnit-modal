const elementName="magnit-modal",shadeClass="modal-shade",KEYCODE={ESC:27,ENTER:13,SPACE:32,TAB:9},OFFSET=10;let modalCount=0;var lastDisposableId=0;const internal=Symbol();export const BaseComponent=(e=HTMLElement)=>(class extends e{static get observedAttributes(){return[]}get isInitialized(){return this[internal].isInitialized}set isInitialized(e){this[internal].isInitialized=e}get isConnected(){return this[internal].isConnected}set isConnected(e){this[internal].isConnected=e}async connectedCallback(){await this.init(),this.isConnected=!0,this.dispatchComponentEvent(this,"onconnect")}attributeChangedCallback(e,t,n){this.isConnected&&(this.update({[e]:n}),this.dispatchComponentEvent(this,"onattributechanged",{name:e,oldValue:t,newValue:n}))}async disconnectedCallback(){await this.destruct(),this.isConnected=!1,this.dispatchComponentEvent(this,"ondisconnect")}adoptedCallback(){this.dispatchComponentEvent(this,"onadopted")}constructor(e){if(super(),this[internal]={},this.isInitialized=!1,null!=e)for(let t in e)e.hasOwnProperty(t)&&this.setAttribute(t,e[t])}init(){}update(){}destruct(){}dispatchComponentEvent(e,t,n){if(e==this){let e=n?new CustomEvent(t,{detail:n}):new CustomEvent(t);this.dispatchEvent(e)}this.dispatchAttributeEvents(e,t,n)}dispatchAttributeEvents(e,t,n){let i="on"+t,o=e.getAttribute(i);if(o&&"null"!=o)try{o=o.split(".").reduce((e,t)=>e[t],window);let t=this,i=e.getAttribute("event-context");null!=i&&(t=i.split(".").reduce((e,t)=>e[t],window)),o.apply(t,{target:e,detail:n})}catch(e){console.error("Unable to execute callback: "),console.error(e)}}attachDOM(e){let t;if(!(e instanceof HTMLTemplateElement)){let t=e;(e=document.createElement("template")).innerHTML=t}const n=(t=e.content.cloneNode(!0)).querySelectorAll("slot");for(const e of n){const t=this.querySelector(`[slot="${e.name}"]`);null!=t?(t.classList.add(e.name),e.parentNode.replaceChild(t,e)):null!=e.firstElementChild&&e.parentNode.replaceChild(e.firstElementChild,e)}this.innerHTML="",this.appendChild(t)}registerStyle(e){let t=(null==this.shadowRoot?this:this.shadowRoot).querySelector("style");null!=t&&(t.remove(),null==document.querySelector(`style[data-id="${e}"]`)&&(t.dataset.id=e,document.head.appendChild(t)))}getDescendants(e,t){e=e||this,t=0!=t;let n=[];for(let i=0;i<e.childNodes.length;i++){let o=e.childNodes[i];n.push(o),o.childNodes&&1==t&&n.push(...this.getDescendants(o))}return n}});const styleId=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)),disposableId=function(){return lastDisposableId++};export default class MagnitModalComponent extends(BaseComponent()){static get observedAttributes(){return["use-shade","shade-close","close-button"]}static register(){customElements.get(elementName)||customElements.define(elementName,MagnitModalComponent)}static get modalCount(){return modalCount}static set modalCount(e){modalCount=e}get loading(){this.getAttribute("loading")}set loading(e){!0!==e?this.removeAttribute("loading"):this.setAttribute("loading","")}get useShade(){return"true"==this.getAttribute("use-shade")}get shadeClose(){return"true"==this.getAttribute("shade-close")}get isOpen(){return this.classList.contains("open")}constructor(e){super(e),this.disposableId=disposableId(),this.asking=!1,this[internal]={},this[internal].document_onKeydown=document_onKeydown.bind(this),this[internal].initFocus=initModalFocus.bind(this),this[internal].addShade=addShade.bind(this),this[internal].removeShade=removeShade.bind(this),this[internal].closeElement_onClick=closeElement_onClick.bind(this),this[internal].choice_onClick=choice_onClick.bind(this),this[internal].tryClose=tryClose.bind(this),this[internal].preventFocus=preventFocus.bind(this,[this]),this[internal].restoreFocus=restoreFocus.bind(this)}init(){this.setAttribute("role","dialog");let e={"use-shade":this.getAttribute("use-shade")||"true","shade-close":this.getAttribute("shade-close")||"false","close-button":this.getAttribute("close-button")||"true"};if(this.isInitialized)return void this.update(e);const t=templateContent;if(this.attachDOM(t),this.registerStyle(styleId),this.$titleIcon=this.querySelector(".identity .icon"),this.$title=this.querySelector(".identity .title"),this.$controls=this.querySelector(".controls"),this.$closeControl=this.$controls.querySelector(".control.close, .control.close button, .control .close"),this.$content=this.querySelector(".content"),this.$footer=this.querySelector("footer"),this.$shade=this.querySelector(`.${shadeClass}`),this.$choices=this.querySelector(".choices")||document.createElement("ul"),this.$shade.remove(),null==this.$closeControl&&(this.$closeControl=document.createElement("button"),this.$closeControl.type="button",this.$closeControl.classList.add("control","close"),this.$closeControl.title="Close modal",this.$closeControl.innerHTML=defaultCloseButtonContent),this.$title.classList.add("title"),this.$titleIcon.classList.add("title"),this.$content.classList.add("content"),this.$choices.classList.add(".choices"),this.style.display=null,this.$title.id="modal-title_"+this.disposableId,this.setAttribute("aria-labelledby",this.$title.id),this.$closeControl.addEventListener("click",this[internal].closeElement_onClick),this.$shade.addEventListener("click",this[internal].closeElement_onClick),"message"===this.getAttribute("type")){let e=this.$choices.querySelector("button.ok");null==e&&((e=document.createElement("button")).textContent="Ok",e.classList.add("ok"),this.$choices.appendChild(e)),e.type="button",e.classList.add("choice"),e.addEventListener("click",this[internal].closeElement_onClick)}if(null!=this.$choices){let e=this.$choices.querySelectorAll("button");for(const t of e)t.addEventListener("click",this[internal].choice_onClick)}this.isInitialized=!0,this.update(e)}update(e){for(let t in e)if(e.hasOwnProperty(t))if("use-shade"==t){let n="true"==e[t];1==this.isInitialized&&(1==n?this.$shade.style.removeProperty("--shade-opacity"):this.$shade.style.setProperty("--shade-opacity",0))}else if("shade-close"==t){let n="true"==e[t];if(1==this.isInitialized){if(!0===n)return void this.$shade.addEventListener("click",this[internal].shadeClickHandler);this.$shade.removeEventListener("click",this[internal].shadeClickHandler)}}else if("close-button"==t){let n="true"==e[t];1==this.isInitialized&&(!0===n?this.$controls.appendChild(this.$closeControl):this.$closeControl.remove())}}destruct(){document.removeEventListener("keydown",this[internal].document_onKeydown)}ask(e=-1){return this.asking=!0,null==this.$choices||0==this.$choices.children.length?Promise.reject("No choices available to await."):new Promise(t=>{const n=async i=>{if(0!=(-1===e||await e(i.detail.$choice)))return i.detail.$choice==this.$shade&&1!=this.shadeClose?void this.addEventListener("onchoice",n,{once:!0}):(this.$closeControl.removeEventListener("click",this[internal].choice_onClick),this.asking=!1,this.close(),void t(i.detail.$choice));this.addEventListener("onchoice",n,{once:!0})};this.addEventListener("onchoice",n,{once:!0}),this.$closeControl.addEventListener("click",this[internal].choice_onClick),this.$shade.addEventListener("click",this[internal].choice_onClick),this.open()})}async open(){this.classList.contains("open")||(this.$previousActiveElement=document.activeElement,this[internal].addShade(),document.addEventListener("keydown",this[internal].document_onKeydown),this[internal].preventFocus(),MagnitModalComponent.modalCount>0&&(this.style.setProperty("--top-offset",-MagnitModalComponent.modalCount*OFFSET+"px"),this.style.setProperty("--left-offset",MagnitModalComponent.modalCount*OFFSET+"px")),this.classList.add("open"),MagnitModalComponent.modalCount++,this.dispatchComponentEvent(this,"onopen"),this[internal].initFocus())}async close(){document.removeEventListener("keydown",this[internal].document_onKeydown),this[internal].restoreFocus(),this[internal].removeShade(),this.classList.remove("open"),this.style.removeProperty("--top-offset"),this.style.removeProperty("--left-offset"),null!=this.$previousActiveElement&&this.$previousActiveElement.focus(),MagnitModalComponent.modalCount--,this.dispatchComponentEvent(this,"onclose")}submitForm(e,t){return new Promise((n,i)=>{0!=e.reportValidity()?(e.addEventListener("submit",e=>{let o=!1;try{o=t(e),n(o)}catch(e){return i(e),!1}finally{return o}},{once:!0}),e.requestSubmit()):i("invalid")})}};function addShade(){null==this.$shade.parentNode&&this.parentNode.insertBefore(this.$shade,this)}function removeShade(){this.$shade.remove()}function tryClose(){1!=this.asking&&this.close()}function closeElement_onClick(e){e.currentTarget==this.$shade&&1!=this.shadeClose||this[internal].tryClose()}function choice_onClick(e){this.dispatchComponentEvent(this,"onchoice",{$choice:e.currentTarget})}function document_onKeydown(e){e.which==KEYCODE.ESC&&this.close()}function initModalFocus(){const e=this.querySelector("header"),t=getFocusableElements(this);if(null!=t)for(const n of t)if(null!=e&&e!=n&&!e.contains(n))return void n.focus()}function getFocusableElements(e=document){return[...e.querySelectorAll('a, button, input, textarea, select, details,[tabindex]:not([tabindex*="-"])')].filter(e=>!e.hasAttribute("disabled"))}function preventFocus(e=[]){if(MagnitModalComponent.modalCount>0)return;const t=getFocusableElements();for(const n of t){let t=!1;if(e.length>0)for(const i of e)if(i==n||i.contains(n)){t=!0;break}1!=t&&(n.hasAttribute("tabindex")&&(n[internal]=n.getAttribute("tabindex")),n.setAttribute("tabindex","-1"),n.dataset.modifyingModal=this.disposableId)}}function restoreFocus(){if(MagnitModalComponent.modalCount>1)return;const e=document.querySelectorAll("[data-modifying-modal]");for(const t of e)t.hasOwnProperty(internal)?t.setAttribute("tabindex",t[internal]):t.removeAttribute("tabindex"),t.removeAttribute("data-modifying-modal")}const defaultCloseButtonContent='<svg class="icon close" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M23 20.168l-8.185-8.187 8.185-8.174-2.832-2.807-8.182 8.179-8.176-8.179-2.81 2.81 8.186 8.196-8.186 8.184 2.81 2.81 8.203-8.192 8.18 8.192z"/></svg>',templateContent=`<style>\n.${shadeClass} { --shade-opacity: .5; position:fixed; top:-1px; left:-1px; right: -1px; bottom: -1px; z-index: 1000; background-color: rgba(0,0,0,var(--shade-opacity)); }\n\n${elementName}\n{\n    --primary-color: #707683;\n    --font-color: #393939;\n    --background-color: #e9e9eb;\n    --background: var(--background-color);\n    --top-offset: 0px;\n    --left-offset: 0px;\n    position: fixed;\n    top: calc(50% + var(--top-offset));\n    left: calc(50% + var(--left-offset));\n    transform: translate(-50%, -50%);\n    z-index:1001;\n    width: max-content;\n    background: var(--background);\n    color: var(--font-color);\n    display: flex;\n    flex-direction: column;\n    border: solid 1px var(--primary-color);\n    box-shadow: 1px 1px 5px 2px rgb(0 0 0 / 30%);\n    min-width: 400px;\n    max-width: 90%;\n    pointer-events: none;\n    visibility: hidden;\n    opacity: 0;\n    transition:  opacity 200ms linear;\n}\n${elementName}.open\n{\n    pointer-events: initial;\n    visibility: visible;\n    opacity: 1;\n}\n\n${elementName} .controls, ${elementName} .choices { list-style: none; margin: 0; padding: 0; }\n${elementName} .controls button, ${elementName} .choices button { all: initial; pointer-events: inherit; cursor: pointer; }\n${elementName} .controls button:hover, ${elementName} .choices button:hover { filter: saturate(110%) brightness(1.05); }\n${elementName} .controls button:active, ${elementName} .choices button:active { transform: scale(.96); }\n\n${elementName} *:focus { --focus-ring-size: 2px; outline: solid var(--focus-ring-size) currentColor; outline-offset: calc(calc(var(--focus-ring-size) * -1) / 2); }\n${elementName} *:focus:focus-visible { outline-style: auto; }\n${elementName} *:focus:not(:focus-visible) { outline-style: none; }\n\n${elementName} svg path { fill: var(--primary-color); }\n${elementName}.info { --primary-color:#3d84e5; --background-color: #cde2ff; }\n${elementName}.success { --primary-color:#3ac279; --background-color: #c5f7dc; }\n${elementName}.warning { --primary-color:#e89f29; --background-color: #ffe8c3; }\n${elementName}.error { --primary-color:#e9594c; --background-color: #ffcfcb; }\n\n${elementName} .icon.title\n{\n    --size: 20px;\n    width: var(--size);\n    height: auto;\n    margin-right: .5em;\n}\n\n${elementName} > header\n{\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: .2em .4em;\n    margin-bottom: 1em;\n}\n\n${elementName} > header .identity\n{\n    display: flex;\n    align-items: center;\n    font-size: 1.3em;\n    font-weight: bold;\n}\n\n${elementName} > header .control\n{\n    background: none;\n    border: none;\n    min-width: initial;\n    flex: initial;\n    padding: 0;\n    display: flex;\n    align-items: center;\n}\n${elementName} > header .control svg\n{\n    --size: 18px;\n    width: var(--size);\n    height: auto;\n}\n\n${elementName} > .content\n{\n    max-height: 80vh;\n    max-width: 80vw;\n    overflow: auto;\n    padding: .2em 1.5em;\n}\n\n${elementName} ul.choices\n{\n    display: flex;\n    justify-content: flex-end;\n    padding: .4em;\n}\n\n${elementName} .choices li\n{\n    margin-right: .5em;\n}\n${elementName} .choices li:last-of-type\n{\n    margin-right: 0;\n}\n\n${elementName} .choices button\n{\n    background-color: var(--primary-color);\n    border: solid 1px rgba(0,0,0,.4);\n    color: #fff;\n    flex: initial;\n    min-width: 2ch; padding: .3em 2em; \n}\n\n${elementName} > footer\n{\n    margin-top: 1em;\n}\n\n\n\n${elementName}[type="message"] .content\n{\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n${elementName}[type="message"] .content .icon-container\n{\n    padding: .5em;\n    margin-right: 1.5em;\n}\n\n${elementName}[type="message"] .content .icon-container svg\n{\n    --size: 42px;\n    width: var(--size);\n    height: auto;\n}\n\n${elementName}[type="message"] .content .message\n{\n    flex: 1;\n}\n\n${elementName}[type="message"] .content .message h5\n{\n    margin: 0;\n}\n</style>\n<header>\n<div class="identity">\n    <slot name="title-icon">\n        <svg class="icon title-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm1 18h-2v-8h2v8zm-1-12.25c.69 0 1.25.56 1.25 1.25s-.56 1.25-1.25 1.25-1.25-.56-1.25-1.25.56-1.25 1.25-1.25z"/></svg>\n    </slot>\n    <slot name="title"><span class="title">Message</span></slot>\n</div>\n<slot name="controls" class="controls">\n    <ul class="controls">\n        <li>\n            <button class="control close" type="button" title="Close modal">\n                ${defaultCloseButtonContent}\n            </button>\n        </li>\n    </ul>\n</slot>\n</header>\n<slot name="content"><div class="content"></div></slot>\n<footer>\n<slot name="choices">\n    <ul class="choices"></ul>\n</slot>\n</footer>\n<div class="${shadeClass}"></div>`;MagnitModalComponent.register();